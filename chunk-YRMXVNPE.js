import{c as W}from"./chunk-NIKCTDH5.js";import{a as L}from"./chunk-HKUNN5OK.js";import{C,Ka as P,La as w,P as O,W as k,X as D,Y as S,ba as j,d as E,f as R,ia as T,ja as q,oa as H,w as g,z as m}from"./chunk-6FL7R2MJ.js";import"./chunk-EQDQRRRY.js";function z(y,o,e,n){if(o>=e){let b=y+(o-e)*n;return g(b,y,o)}else if(o<e){let b=y-(e-o)*n;return g(b,o,y)}}var v="bubble",B=0,J=0,K=2,A=1,F=1,N=0,Q=0,M=.5,_=1,I=class extends L{constructor(o){super(o),this._clickBubble=()=>{let e=this.container,n=e.actualOptions,b=e.interactivity.mouse.clickPosition,l=n.interactivity.modes.bubble;if(!l||!b)return;e.bubble||(e.bubble={});let t=e.retina.bubbleModeDistance;if(!t||t<B)return;let s=e.particles.quadTree.queryCircle(b,t,i=>this.isEnabled(i)),{bubble:u}=e;for(let i of s){if(!u.clicking)continue;i.bubble.inRange=!u.durationEnd;let r=i.getPosition(),c=C(r,b),f=(new Date().getTime()-(e.interactivity.mouse.clickTime??J))/1e3;f>l.duration&&(u.durationEnd=!0),f>l.duration*K&&(u.clicking=!1,u.durationEnd=!1);let d={bubbleObj:{optValue:e.retina.bubbleModeSize,value:i.bubble.radius},particlesObj:{optValue:m(i.options.size.value)*e.retina.pixelRatio,value:i.size.value},type:"size"};this._process(i,c,f,d);let p={bubbleObj:{optValue:l.opacity,value:i.bubble.opacity},particlesObj:{optValue:m(i.options.opacity.value),value:i.opacity?.value??A},type:"opacity"};this._process(i,c,f,p),!u.durationEnd&&c<=t?this._hoverBubbleColor(i,c):delete i.bubble.color}},this._hoverBubble=()=>{let e=this.container,n=e.interactivity.mouse.position,b=e.retina.bubbleModeDistance;if(!b||b<B||!n)return;let l=e.particles.quadTree.queryCircle(n,b,t=>this.isEnabled(t));for(let t of l){t.bubble.inRange=!0;let s=t.getPosition(),u=C(s,n),i=F-u/b;u<=b?i>=Q&&e.interactivity.status===R&&(this._hoverBubbleSize(t,i),this._hoverBubbleOpacity(t,i),this._hoverBubbleColor(t,i)):this.reset(t),e.interactivity.status===E&&this.reset(t)}},this._hoverBubbleColor=(e,n,b)=>{let l=this.container.actualOptions,t=b??l.interactivity.modes.bubble;if(t){if(!e.bubble.finalColor){let s=t.color;if(!s)return;let u=j(s);e.bubble.finalColor=T(u)}if(e.bubble.finalColor)if(t.mix){e.bubble.color=void 0;let s=e.getFillColor();e.bubble.color=s?q(H(s,e.bubble.finalColor,F-n,n)):e.bubble.finalColor}else e.bubble.color=e.bubble.finalColor}},this._hoverBubbleOpacity=(e,n,b)=>{let l=this.container,t=l.actualOptions,s=b?.opacity??t.interactivity.modes.bubble?.opacity;if(!s)return;let u=e.options.opacity.value,i=e.opacity?.value??A,r=z(i,s,m(u),n);r!==void 0&&(e.bubble.opacity=r)},this._hoverBubbleSize=(e,n,b)=>{let l=this.container,t=b?.size?b.size*l.retina.pixelRatio:l.retina.bubbleModeSize;if(t===void 0)return;let s=m(e.options.size.value)*l.retina.pixelRatio,u=e.size.value,i=z(u,t,s,n);i!==void 0&&(e.bubble.radius=i)},this._process=(e,n,b,l)=>{let t=this.container,s=l.bubbleObj.optValue,u=t.actualOptions,i=u.interactivity.modes.bubble;if(!i||s===void 0)return;let r=i.duration,c=t.retina.bubbleModeDistance,f=l.particlesObj.optValue,d=l.bubbleObj.value,p=l.particlesObj.value??N,a=l.type;if(!(!c||c<B||s===f))if(t.bubble||(t.bubble={}),t.bubble.durationEnd)d&&(a==="size"&&delete e.bubble.radius,a==="opacity"&&delete e.bubble.opacity);else if(n<=c){if((d??p)!==s){let h=p-b*(p-s)/r;a==="size"&&(e.bubble.radius=h),a==="opacity"&&(e.bubble.opacity=h)}}else a==="size"&&delete e.bubble.radius,a==="opacity"&&delete e.bubble.opacity},this._singleSelectorHover=(e,n,b)=>{let l=this.container,t=document.querySelectorAll(n),s=l.actualOptions.interactivity.modes.bubble;!s||!t.length||t.forEach(u=>{let i=u,r=l.retina.pixelRatio,c={x:(i.offsetLeft+i.offsetWidth*M)*r,y:(i.offsetTop+i.offsetHeight*M)*r},f=i.offsetWidth*M*r,d=b.type==="circle"?new P(c.x,c.y,f):new w(i.offsetLeft*r,i.offsetTop*r,i.offsetWidth*r,i.offsetHeight*r),p=l.particles.quadTree.query(d,a=>this.isEnabled(a));for(let a of p){if(!d.contains(a.getPosition()))continue;a.bubble.inRange=!0;let x=s.divs,h=S(x,i);(!a.bubble.div||a.bubble.div!==i)&&(this.clear(a,e,!0),a.bubble.div=i),this._hoverBubbleSize(a,_,h),this._hoverBubbleOpacity(a,_,h),this._hoverBubbleColor(a,_,h)}})},o.bubble||(o.bubble={}),this.handleClickMode=e=>{e===v&&(o.bubble||(o.bubble={}),o.bubble.clicking=!0)}}clear(o,e,n){o.bubble.inRange&&!n||(delete o.bubble.div,delete o.bubble.opacity,delete o.bubble.radius,delete o.bubble.color)}init(){let o=this.container,e=o.actualOptions.interactivity.modes.bubble;e&&(o.retina.bubbleModeDistance=e.distance*o.retina.pixelRatio,e.size!==void 0&&(o.retina.bubbleModeSize=e.size*o.retina.pixelRatio))}interact(o){let e=this.container.actualOptions,n=e.interactivity.events,b=n.onHover,l=n.onClick,t=b.enable,s=b.mode,u=l.enable,i=l.mode,r=n.onDiv;t&&O(v,s)?this._hoverBubble():u&&O(v,i)?this._clickBubble():D(v,r,(c,f)=>this._singleSelectorHover(o,c,f))}isEnabled(o){let e=this.container,n=e.actualOptions,b=e.interactivity.mouse,l=(o?.interactivity??n.interactivity).events,{onClick:t,onDiv:s,onHover:u}=l,i=k(v,s);return i||u.enable&&b.position||t.enable&&b.clickPosition?O(v,u.mode)||O(v,t.mode)||i:!1}loadModeOptions(o,...e){o.bubble||(o.bubble=new W);for(let n of e)o.bubble.load(n?.bubble)}reset(o){o.bubble.inRange=!1}};export{I as Bubbler};
