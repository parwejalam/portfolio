import{c}from"./chunk-ZFRCLHPY.js";import{c as d}from"./chunk-QGTVGRBI.js";import"./chunk-HKUNN5OK.js";import{m as f}from"./chunk-6FL7R2MJ.js";import{f as m}from"./chunk-EQDQRRRY.js";var u=2,_=1,C=12,I=1,p=class{constructor(o){this.loadImageShape=e=>m(this,null,function*(){if(!this._engine.loadImage)throw new Error(`${f} image shape not initialized`);yield this._engine.loadImage({gif:e.gif,name:e.name,replaceColor:e.replaceColor??!1,src:e.src})}),this._engine=o}addImage(o){this._engine.images||(this._engine.images=[]),this._engine.images.push(o)}draw(o){let{context:e,radius:t,particle:i,opacity:n}=o,a=i.image,g=a?.element;if(a){if(e.globalAlpha=n,a.gif&&a.gifData)c(o);else if(g){let s=a.ratio,r={x:-t,y:-t},l=t*u;e.drawImage(g,r.x,r.y,l,l/s)}e.globalAlpha=_}}getSidesCount(){return C}init(o){return m(this,null,function*(){let e=o.actualOptions;if(!(!e.preload||!this._engine.loadImage))for(let t of e.preload)yield this._engine.loadImage(t)})}loadShape(o){if(o.shape!=="image"&&o.shape!=="images")return;this._engine.images||(this._engine.images=[]);let e=o.shapeData;if(!e)return;this._engine.images.find(i=>i.name===e.name||i.source===e.src)||this.loadImageShape(e).then(()=>{this.loadShape(o)})}particleInit(o,e){if(e.shape!=="image"&&e.shape!=="images")return;this._engine.images||(this._engine.images=[]);let t=this._engine.images,i=e.shapeData;if(!i)return;let n=e.getFillColor(),a=t.find(s=>s.name===i.name||s.source===i.src);if(!a)return;let g=i.replaceColor??a.replaceColor;if(a.loading){setTimeout(()=>{this.particleInit(o,e)});return}m(this,null,function*(){let s;a.svgData&&n?s=yield d(a,i,n,e):s={color:n,data:a,element:a.element,gif:a.gif,gifData:a.gifData,gifLoopCount:a.gifLoopCount,loaded:!0,ratio:i.width&&i.height?i.width/i.height:a.ratio??I,replaceColor:g,source:i.src},s.ratio||(s.ratio=1);let r=i.fill??e.shapeFill,l=i.close??e.shapeClose,h={image:s,fill:r,close:l};e.image=h.image,e.shapeFill=h.fill,e.shapeClose=h.close})}};export{p as ImageDrawer};
