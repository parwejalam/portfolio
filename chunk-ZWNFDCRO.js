import"./chunk-HKUNN5OK.js";import{B as q,C as b,ha as m,ma as T,pa as F,ua as _,v as L,y as O}from"./chunk-6FL7R2MJ.js";import{f as P}from"./chunk-EQDQRRRY.js";function j(a,s,n,i){a.beginPath(),a.moveTo(s.x,s.y),a.lineTo(n.x,n.y),a.lineTo(i.x,i.y),a.closePath()}function R(a){let s=!1,{begin:n,end:i,maxDistance:o,context:t,canvasSize:e,width:l,backgroundMask:d,colorLine:f,opacity:h,links:u}=a;if(b(n,i)<=o)_(t,n,i),s=!0;else if(u.warp){let r,k,w={x:i.x-e.width,y:i.y},p=q(n,w);if(p.distance<=o){let c=n.y-p.dy/p.dx*n.x;r={x:0,y:c},k={x:e.width,y:c}}else{let c={x:i.x,y:i.y-e.height},y=q(n,c);if(y.distance<=o){let x=-(n.y-y.dy/y.dx*n.x)/(y.dy/y.dx);r={x,y:0},k={x,y:e.height}}else{let C={x:i.x-e.width,y:i.y-e.height},x=q(n,C);if(x.distance<=o){let v=n.y-x.dy/x.dx*n.x;r={x:-v/(x.dy/x.dx),y:v},k={x:r.x+e.width,y:r.y+e.height}}}}r&&k&&(_(t,n,r),_(t,i,k),s=!0)}if(!s)return;t.lineWidth=l,d.enable&&(t.globalCompositeOperation=d.composite),t.strokeStyle=T(f,h);let{shadow:g}=u;if(g.enable){let r=m(g.color);r&&(t.shadowBlur=g.blur,t.shadowColor=T(r))}t.stroke()}function S(a){let{context:s,pos1:n,pos2:i,pos3:o,backgroundMask:t,colorTriangle:e,opacityTriangle:l}=a;j(s,n,i,o),t.enable&&(s.globalCompositeOperation=t.composite),s.fillStyle=T(e,l),s.fill()}function B(a){return a.sort((s,n)=>s-n),a.join("_")}function D(a,s){let n=B(a.map(o=>o.id)),i=s.get(n);return i===void 0&&(i=L(),s.set(n,i)),i}var W=0,M=0,z=0,K=.5,N=1,E=class{constructor(s){this.container=s,this._drawLinkLine=(n,i)=>{let o=n.options.links;if(!o?.enable)return;let t=this.container,e=t.actualOptions,l=i.destination,d=n.getPosition(),f=l.getPosition(),h=i.opacity;t.canvas.draw(u=>{let g,r=n.options.twinkle?.lines;if(r?.enable){let c=r.frequency,y=m(r.color);L()<c&&y&&(g=y,h=O(r.opacity))}if(!g){let c=o.id!==void 0?t.particles.linksColors.get(o.id):t.particles.linksColor;g=F(n,l,c)}if(!g)return;let k=n.retina.linksWidth??M,w=n.retina.linksDistance??z,{backgroundMask:p}=e;R({context:u,width:k,begin:d,end:f,maxDistance:w,canvasSize:t.canvas.size,links:o,backgroundMask:p,colorLine:g,opacity:h})})},this._drawLinkTriangle=(n,i,o)=>{let t=n.options.links;if(!t?.enable)return;let e=t.triangles;if(!e.enable)return;let l=this.container,d=l.actualOptions,f=i.destination,h=o.destination,u=e.opacity??(i.opacity+o.opacity)*K;u<=W||l.canvas.draw(g=>{let r=n.getPosition(),k=f.getPosition(),w=h.getPosition(),p=n.retina.linksDistance??z;if(b(r,k)>p||b(w,k)>p||b(w,r)>p)return;let c=m(e.color);if(!c){let y=t.id!==void 0?l.particles.linksColors.get(t.id):l.particles.linksColor;c=F(n,f,y)}c&&S({context:g,pos1:r,pos2:k,pos3:w,backgroundMask:d.backgroundMask,colorTriangle:c,opacityTriangle:u})})},this._drawTriangles=(n,i,o,t)=>{let e=o.destination;if(!(n.links?.triangles.enable&&e.options.links?.triangles.enable))return;let l=e.links?.filter(d=>{let f=this._getLinkFrequency(e,d.destination);return e.options.links&&f<=e.options.links.frequency&&t.findIndex(u=>u.destination===d.destination)>=0});if(l?.length)for(let d of l){let f=d.destination;this._getTriangleFrequency(i,e,f)>n.links.triangles.frequency||this._drawLinkTriangle(i,o,d)}},this._getLinkFrequency=(n,i)=>D([n,i],this._freqs.links),this._getTriangleFrequency=(n,i,o)=>D([n,i,o],this._freqs.triangles),this._freqs={links:new Map,triangles:new Map}}drawParticle(s,n){let{links:i,options:o}=n;if(!i?.length)return;let t=i.filter(e=>o.links&&(o.links.frequency>=N||this._getLinkFrequency(n,e.destination)<=o.links.frequency));for(let e of t)this._drawTriangles(o,n,e,t),e.opacity>W&&(n.retina.linksWidth??M)>M&&this._drawLinkLine(n,e)}init(){return P(this,null,function*(){this._freqs.links=new Map,this._freqs.triangles=new Map,yield Promise.resolve()})}particleCreated(s){if(s.links=[],!s.options.links)return;let n=this.container.retina.pixelRatio,{retina:i}=s,{distance:o,width:t}=s.options.links;i.linksDistance=o*n,i.linksWidth=t*n}particleDestroyed(s){s.links=[]}};export{E as LinkInstance};
